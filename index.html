<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Simulador Martingala</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <style>
      body {
        background: linear-gradient(to right, #eef2f3, #8e9eab);
        min-height: 100vh;
      }
      .simulator-box {
        background-color: white;
        border-radius: 20px;
        box-shadow: 0 0 25px rgba(0, 0, 0, 0.1);
        padding: 30px;
      }
      .result-box {
        height: 300px;
        overflow-y: auto;
        white-space: pre-wrap;
        font-family: monospace;
        background-color: #f8f9fa;
        padding: 15px;
        border-radius: 10px;
        border: 1px solid #dee2e6;
      }
    </style>
  </head>
  <body>
    <div class="container py-5">
      <div class="simulator-box mx-auto col-lg-8 col-md-10 col-sm-12">
        <div class="text-center mb-4">
          <h2><i class="bi bi-graph-up-arrow"></i> Simulador de Martingala</h2>
          <p class="text-muted">
            Configura tus parámetros y simula el crecimiento diario
          </p>
        </div>

        <!-- Inputs -->
        <form id="configForm" class="mb-4">
          <div class="mb-3">
            <label class="form-label"
              ><i class="bi bi-sliders"></i> Multiplicadores (separados por
              coma):</label
            >
            <input
              type="text"
              class="form-control"
              id="multiplicadoresInput"
              value="1, 2.13, 4.54, 9.68, 20.66, 44.15"
            />
          </div>

          <div class="row g-3 mb-3">
            <div class="col-md-6">
              <label class="form-label"
                ><i class="bi bi-percent"></i> Payout (%):</label
              >
              <input
                type="number"
                step="0.01"
                min="0"
                max="1"
                class="form-control"
                id="payoutInput"
                value="0.88"
              />
            </div>

            <div class="col-md-6">
              <label class="form-label"
                ><i class="bi bi-123"></i> Entradas por día:</label
              >
              <input
                type="number"
                min="1"
                class="form-control"
                id="entradasInput"
                value="6"
              />
            </div>
          </div>

          <div class="d-grid">
            <button type="submit" class="btn btn-primary btn-lg">
              <i class="bi bi-play-fill"></i> Simular Día
            </button>
          </div>
        </form>

        <!-- Resultados -->
        <div id="resultados" class="result-box"></div>
      </div>
    </div>

    <script>
      let dia = 1;
      let multiplicadores = [1, 2.13, 4.54, 9.68, 20.66, 44.15];
      let recursoInicial = multiplicadores.reduce((a, b) => a + b, 0);
      let payout = 0.88;
      let entradasPorDia = 6;

      document
        .getElementById("configForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();
          // Leer inputs
          const multInput = document.getElementById(
            "multiplicadoresInput"
          ).value;
          const payoutInput = parseFloat(
            document.getElementById("payoutInput").value
          );
          const entradasInput = parseInt(
            document.getElementById("entradasInput").value
          );

          const nuevosMultiplicadores = multInput
            .split(",")
            .map((v) => parseFloat(v.trim()))
            .filter((v) => !isNaN(v));

          if (
            nuevosMultiplicadores.length === 0 ||
            isNaN(payoutInput) ||
            isNaN(entradasInput)
          ) {
            alert("Por favor ingresa valores válidos.");
            return;
          }

          multiplicadores = nuevosMultiplicadores;
          recursoInicial = multiplicadores.reduce((a, b) => a + b, 0);
          payout = payoutInput;
          entradasPorDia = entradasInput;

          simularDia();
        });

      function simularDia() {
        const entradaBase = multiplicadores[0];
        const gananciaTotal = +(entradaBase * entradasPorDia * payout).toFixed(
          2
        );
        const totalConGanancia = +(recursoInicial + gananciaTotal).toFixed(2);
        const factorAjuste = +(totalConGanancia / recursoInicial).toFixed(4);

        const nuevosMultiplicadores = multiplicadores.map(
          (m) => +(m * factorAjuste).toFixed(2)
        );
        const nuevoMultiplicador = nuevosMultiplicadores[1];
        const nuevoPorcentaje = +(
          (nuevoMultiplicador - entradaBase) *
          100
        ).toFixed(2);

        const resumen = `
Día ${dia}:
  Multiplicadores de Martingala:
   - Día ${dia}: ${Math.round(nuevoPorcentaje)}% = ${nuevoMultiplicador}
  Recurso inicial (total martingalas): ${recursoInicial}
  Ganancia total (${entradasPorDia} entradas de ${entradaBase}): ${gananciaTotal}
  Total con ganancia: ${totalConGanancia}
  Factor de ajuste: ${factorAjuste}
  Nuevos multiplicadores para el siguiente día: [${nuevosMultiplicadores.join(
    ", "
  )}]
------------------------------------------------------------
`;

        const resultadosBox = document.getElementById("resultados");
        resultadosBox.textContent += resumen;
        resultadosBox.scrollTop = resultadosBox.scrollHeight;

        recursoInicial = totalConGanancia;
        multiplicadores = nuevosMultiplicadores;
        dia++;
      }
    </script>
  </body>
</html>
